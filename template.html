<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Tax Calculator</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">


    <style>
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    

    <div class="container" id="main-content">
      <!-- Social Icons -->
      <div class="social-icons mb-3">
        <i class="fab fa-twitter"></i>
        <i class="fab fa-facebook"></i>
        <i class="fab fa-linkedin"></i>
        <i class="fas fa-paper-plane"></i>
      </div>

      <h2>Select a Profile or Create a Scenario</h2>

      <!-- Profiles -->
      <div class="profiles">
        <div class="card create" id="createCard">
          <img src="https://img.icons8.com/color/96/add.png"
            alt="Create Scenario" />
          <p><strong>Create a Custom Scenario</strong></p>
        </div>

        <div class="card" id="jamesCard">
          <img
            src="https://img.icons8.com/color/96/user-male.png"
            alt="James" />
          <p>
            <strong>James</strong><br />
            Single, No Kids<br />
            $30,000
          </p>
          <div id="jamesResult" style="display:none;"></div>
        </div>

        <div class="card" id="jasonCard">
          <div id="jasonResult" style="display:none;"></div>
          <img
            src="https://img.icons8.com/color/96/businessman.png"
            alt="Jason" />
          <p><strong>Jason</strong><br />Single, 2 Kids<br />$52,000</p>
        </div>

        <div class="card" id="amberCard">
          <img
            src="https://img.icons8.com/color/96/user-female.png"
            alt="Amber" />
          <p><strong>Amber</strong><br />Single, No Kids<br />$75,000</p>
          <div id="jamesResult" style="display:none;"></div>
        </div>

        <div class="card" id="nickKavyaCard">
          <img
            src="https://img.icons8.com/color/96/family.png"
            alt="Kavya & Nick" />
          <p><strong>Kavya & Nick</strong><br />Married, 2 Kids<br />$85,000</p>
          <div id="kanyanickResult" style="display:none;"></div>
        </div>
      </div>

      <!-- filing status modal -->
      <div class="modal fade" id="filingStatusModal" tabindex="-1"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content p-3">
            <div class="modal-header border-0">
              <h5 class="modal-title">Choose a Filing Status</h5>
              <button type="button" class="btn-close"
                data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="deduction-options d-flex gap-3 my-3">
                <button class="btn btn-success w-50">Single Filer</button>
                <button class="btn btn-outline-warning w-50">Married Filing Jointly</button>
              </div>
              <div class="deduction-options d-flex gap-3 my-3">
                <button class="btn btn-success w-50">Married Filing Separately</button>
                <button class="btn btn-outline-warning w-50">Head of House Hold</button>
              </div>
              <div class="deduction-options d-flex gap-3 my-3">
                <button class="btn btn-success w-100">Qualifying Widow(er)</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Form -->

      <div id="custom-form" class="form hidden mt-4">
        <!-- Fields for Single -->
        <div id="singleFields" class="row g-3 hidden">

          <h4 style="text-align: center;">Single</h4>

          <!-- Annual Income -->
          <div class="col-md-6">
            <label>Annual Income</label>
            <input type="number" class="form-control" id="annual_income"
              name="annual_income" placeholder="0" />
          </div>

          <!-- Pay Periods -->
          <div class="col-md-6">
            <label>Pay Periods</label>
            <input type="number" class="form-control" id="pay_periods"
              name="pay_periods" placeholder="26" />
          </div>

          <!-- Current Withholding -->
          <div class="col-md-6">
            <label>Current Withholding</label>
            <input type="number" class="form-control" id="current_withholding"
              name="current_withholding" placeholder="0" />
          </div>

          <!-- Additional Withholding -->
          <div class="col-md-6">
            <label>Additional Withholding</label>
            <input type="number" class="form-control"
              id="additional_withholding" name="additional_withholding"
              placeholder="0" />
          </div>

          <!-- Dependents -->
          <div class="col-md-6">
            <label>Dependents</label>
            <input type="number" class="form-control" id="dependents"
              name="dependents" placeholder="0" />
          </div>

          <!-- Other Income -->
          <div class="col-md-6">
            <label>Other Income</label>
            <input type="number" class="form-control" id="other_income"
              name="other_income" placeholder="0" />
          </div>

          <!-- Deductions -->
          <div class="col-md-6">
            <label>Deductions</label>
            <input type="number" class="form-control" id="deductions"
              name="deductions" placeholder="0" />
          </div>

          <!-- Income Type -->
          <div class="col-md-6">
            <label>Income Type</label>
            <select class="form-select" id="income_type" name="income_type">
              <option value="salary">Salary</option>
              <option value="hourly">Hourly</option>
              <option value="self-employed">Self-Employed Income</option>
            </select>
          </div>

          <!-- Income Period -->
          <div class="col-md-6">
            <label>Income Period</label>
            <select class="form-select" id="income_period" name="income_period">
              <option value="full_year">Full Year</option>
              <option value="partial_year">Partial Year</option>
            </select>
          </div>

          <!-- Job Incomes (Dynamic Rows) -->
          <div class="col-md-12">
            <label>Job Incomes</label>
            <div id="jobIncomesWrapper"></div>
            <button type="button" class="btn btn-sm btn-primary mt-2"
              onclick="addJobIncome('jobIncomesWrapperSingle')">+ Add Job</button>
              <div id="jobIncomesWrapperSingle"></div>
          </div>

          <!-- Hidden fixed values -->
          <input type="hidden" id="filing_status" name="filing_status"
            value="single" />
          <input type="hidden" id="filing_jointly_both_work"
            name="filing_jointly_both_work" value="false" />
          <input type="hidden" id="spouse_income" name="spouse_income"
            value="0" />

          <!-- Confirm -->
          <div class="col-md-12">
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox"
                id="checkpointSingle" name="checkpointSingle" />
              <label class="form-check-label" for="checkpointSingle">
                Confirm all data entered is accurate
              </label>
            </div>
          </div>
        </div>

        <!--End Fields for Single -->

        <!-- Fields for Married -->
        <div id="marriedFields" class="row g-3 hidden">

          <h4 style="text-align: center;">Married Jointly</h4>


          <!-- Annual Income -->
          <div class="col-md-6">
            <label>Annual Income</label>
            <input
              type="number"
              class="form-control"
              id="annual_income_married"
              name="annual_income"
              value="0" />
          </div>

          <!-- Spouse Income -->
          <div class="col-md-6">
            <label>Spouse Income</label>
            <input
              type="number"
              class="form-control"
              id="spouse_income"
              name="spouse_income"
              value="0" />
          </div>

          <!-- Pay Periods -->
          <div class="col-md-6">
            <label>Pay Periods</label>
            <input
              type="number"
              class="form-control"
              id="pay_periods_married"
              name="pay_periods"
              value="26" />
          </div>

          <!-- Current Withholding -->
          <div class="col-md-6">
            <label>Current Withholding</label>
            <input
              type="number"
              class="form-control"
              id="current_withholding_married"
              name="current_withholding"
              value="0" />
          </div>

          <!-- Additional Withholding -->
          <div class="col-md-6">
            <label>Additional Withholding</label>
            <input
              type="number"
              class="form-control"
              id="additional_withholding_married"
              name="additional_withholding"
              value="0" />
          </div>

          <!-- Dependents -->
          <div class="col-md-6">
            <label>Dependents</label>
            <input
              type="number"
              class="form-control"
              id="dependents_married"
              name="dependents"
              value="0" />
          </div>

          <!-- Other Income -->
          <div class="col-md-6">
            <label>Other Income</label>
            <input
              type="number"
              class="form-control"
              id="other_income_married"
              name="other_income"
              value="0" />
          </div>

          <!-- Deductions -->
          <div class="col-md-6">
            <label>Deductions</label>
            <input
              type="number"
              class="form-control"
              id="deductions_married"
              name="deductions"
              value="0" />
          </div>

          <!-- Both Work -->
          <div class="col-md-6">
            <label>Both Work?</label><br />
            <input
              type="checkbox"
              id="filing_jointly_both_work"
              name="filing_jointly_both_work" />
          </div>

          <!-- Income Type -->
          <div class="col-md-6">
            <label>Income Type</label>
            <select class="form-select" id="income_type_married"
              name="income_type">
              <option value="salary">Salary</option>
              <option value="hourly">Hourly</option>
              <option value="self-employed">Self-Employed Income</option>
            </select>
          </div>

          <!-- Income Period -->
          <div class="col-md-6">
            <label>Income Period</label>
            <select class="form-select" id="income_period_married"
              name="income_period">
              <option value="full_year">Full Year</option>
              <option value="partial_year">Partial Year</option>
            </select>
          </div>

          <!-- Job Incomes -->
          <div class="col-md-12">
            <label>Job Incomes</label>
            <div id="jobIncomesWrapper"></div>
            <button type="button" class="btn btn-sm btn-primary mt-2"
              onclick="addJobIncome('jobIncomesWrapperMarried')">+ Add Job</button>
              <div id="jobIncomesWrapperMarried"></div>
          </div>

          <!-- Hidden fixed value -->
          <input type="hidden" id="filing_status_married" name="filing_status"
            value="marriedJointly" />

          <!-- Checkpoint -->
          <div class="col-md-12">
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox"
                id="checkpointMarried" name="checkpointMarried" />
              <label class="form-check-label" for="checkpointMarried">
                Confirm all data entered is accurate
              </label>
            </div>
          </div>
        </div>

        <!--End Fields for Married -->

        <!-- Fields for HouseHoldFields -->
        <div id="HeadofhouseholdFields" class="row g-3 hidden">

          <h4 style="text-align: center;">Head Of household</h4>


          <!-- Annual Income -->
          <div class="col-md-6">
            <label>Annual Income</label>
            <input
              type="number"
              class="form-control"
              id="annual_income_hoh"
              name="annual_income"
              placeholder="0" />
          </div>

          <!-- Pay Periods -->
          <div class="col-md-6">
            <label>Pay Periods</label>
            <input
              type="number"
              class="form-control"
              id="pay_periods_hoh"
              name="pay_periods"
              placeholder="26" />
          </div>

          <!-- Current Withholding -->
          <div class="col-md-6">
            <label>Current Withholding</label>
            <input
              type="number"
              class="form-control"
              id="current_withholding_hoh"
              name="current_withholding"
              placeholder="0" />
          </div>

          <!-- Additional Withholding -->
          <div class="col-md-6">
            <label>Additional Withholding</label>
            <input
              type="number"
              class="form-control"
              id="additional_withholding_hoh"
              name="additional_withholding"
              placeholder="0" />
          </div>

          <!-- Dependents -->
          <div class="col-md-6">
            <label>Dependents</label>
            <input
              type="number"
              class="form-control"
              id="dependents_hoh"
              name="dependents"
              placeholder="0" />
          </div>

          <!-- Other Income -->
          <div class="col-md-6">
            <label>Other Income</label>
            <input
              type="number"
              class="form-control"
              id="other_income_hoh"
              name="other_income"
              placeholder="0" />
          </div>

          <!-- Deductions -->
          <div class="col-md-6">
            <label>Deductions</label>
            <input
              type="number"
              class="form-control"
              id="deductions_hoh"
              name="deductions"
              placeholder="0" />
          </div>

          <!-- Both Work? -->
          <div class="col-md-6">
            <label>Both Work?</label><br />
            <input
              type="checkbox"
              id="filing_jointly_both_work_hoh"
              name="filing_jointly_both_work" />
          </div>

          <!-- Spouse Income -->
          <div class="col-md-6">
            <label>Spouse Income</label>
            <input
              type="number"
              class="form-control"
              id="spouse_income_hoh"
              name="spouse_income"
              placeholder="0" />
          </div>

          <!-- Income Type -->
          <div class="col-md-6">
            <label>Income Type</label>
            <select class="form-select" id="income_type_hoh" name="income_type">
              <option value="salary">Salary</option>
              <option value="hourly">Hourly</option>
              <option value="self-employed">Self-Employed Income</option>
            </select>
          </div>

          <!-- Income Period -->
          <div class="col-md-6">
            <label>Income Period</label>
            <select class="form-select" id="income_period_hoh"
              name="income_period">
              <option value="full_year">Full Year</option>
              <option value="partial_year">Partial Year</option>
            </select>
          </div>

          <!-- Job Incomes -->
          <div class="col-md-12">
            <label>Job Incomes</label>
            <div id="jobIncomesWrapper"></div>
            <button type="button" class="btn btn-sm btn-primary mt-2"
              onclick="addJobIncome('jobIncomesheadofhousehold')">+ Add Job</button>
              <div id="jobIncomesheadofhousehold"></div>
            </div>

          <!-- Hidden fixed value -->
          <input type="hidden" id="filing_status_hoh" name="filing_status"
            value="headOfHousehold" />

          <!-- Confirm -->
          <div class="col-md-12">
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" id="checkpointHoh"
                name="checkpointHoh" />
              <label class="form-check-label" for="checkpointHoh">
                Confirm all data entered is accurate
              </label>
            </div>
          </div>
        </div>

        <!-- End Fields for HouseHoldFields -->

        <!-- Qualifying Widower Fields -->
        <div id="QualifyingWidowerFields" class="row g-3 hidden">

          <h4 style="text-align: center;">Qualifying Widower</h4>

          <div class="col-md-6">
            <label>Annual Income</label>
            <input type="number" class="form-control" id="annual_income_qw"
              placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Pay Periods</label>
            <input type="number" class="form-control" id="pay_periods_qw"
              placeholder="26" />
          </div>

          <div class="col-md-6">
            <label>Current Withholding</label>
            <input type="number" class="form-control" id="current_withholding_qw"
              placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Additional Withholding</label>
            <input type="number" class="form-control"
              id="additional_withholding_qw" placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Dependents</label>
            <input type="number" class="form-control" id="dependents_qw"
              placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Other Income</label>
            <input type="number" class="form-control" id="other_income_qw"
              placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Deductions</label>
            <input type="number" class="form-control" id="deductions_qw"
              placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Both Work?</label>
            <input type="checkbox" class="form-check-input"
              id="filing_jointly_both_work_qw" />
          </div>

          <div class="col-md-6">
            <label>Spouse Income</label>
            <input type="number" class="form-control" id="spouse_income_qw"
              placeholder="0" />
          </div>

          <div class="col-md-6">
            <label>Income Type</label>
            <select class="form-control" id="income_type_qw">
              <option value="salary">Salary</option>
              <option value="hourly">Hourly</option>
              <option value="self-employed">Self-Employed</option>
            </select>
          </div>

          <div class="col-md-6">
            <label>Income Period</label>
            <select class="form-control" id="income_period_qw">
              <option value="full_year">Full Year</option>
              <option value="partial_year">Partial Year</option>
            </select>
          </div>

          <div class="col-md-12">
            <label>Job Incomes</label>
            <button type="button" class="btn btn-sm btn-primary mt-2"
              onclick="addJobIncome('jobIncomesqualifyingwidower')">+ Add Job</button>
              <div id="jobIncomesqualifyingwidower_qw"></div>
          </div>

        </div>

        <!--End Qualifying Widower Fields -->

        <!-- Fields for MarriedFilingSepratelyFields -->

        <div id="MarriedFilingSeparatelyFields" class="row g-3 hidden">

          <h4 style="text-align: center;">Married Separeately</h4>

          <!-- Annual Income -->
          <div class="col-md-6">
            <label>Annual Income</label>
            <input type="number" class="form-control" id="annual_income_mfs"
              name="annual_income" placeholder="0" />
          </div>

          <!-- Pay Periods -->
          <div class="col-md-6">
            <label>Pay Periods</label>
            <input type="number" class="form-control" id="pay_periods_mfs"
              name="pay_periods" placeholder="26" />
          </div>

          <!-- Current Withholding -->
          <div class="col-md-6">
            <label>Current Withholding</label>
            <input type="number" class="form-control"
              id="current_withholding_mfs" name="current_withholding"
              placeholder="0" />
          </div>

          <!-- Additional Withholding -->
          <div class="col-md-6">
            <label>Additional Withholding</label>
            <input type="number" class="form-control"
              id="additional_withholding_mfs" name="additional_withholding"
              placeholder="0" />
          </div>

          <!-- Dependents -->
          <div class="col-md-6">
            <label>Dependents</label>
            <input type="number" class="form-control" id="dependents_mfs"
              name="dependents" placeholder="0" />
          </div>

          <!-- Other Income -->
          <div class="col-md-6">
            <label>Other Income</label>
            <input type="number" class="form-control" id="other_income_mfs"
              name="other_income" placeholder="0" />
          </div>

          <!-- Deductions -->
          <div class="col-md-6">
            <label>Deductions</label>
            <input type="number" class="form-control" id="deductions_mfs"
              name="deductions" placeholder="0" />
          </div>

          <!-- Filing Jointly Both Work? -->
          <div class="col-md-6">
            <label>Both Work?</label>
            <input type="checkbox" class="form-check-input"
              id="filing_jointly_both_work_mfs"
              name="filing_jointly_both_work" />
          </div>

          <!-- Spouse Income -->
          <div class="col-md-6">
            <label>Spouse Income</label>
            <input type="number" class="form-control" id="spouse_income_mfs"
              name="spouse_income" placeholder="0" />
          </div>

          <!-- Income Type -->
          <div class="col-md-6">
            <label>Income Type</label>
            <select class="form-control" id="income_type_mfs"
              name="income_type">
              <option value="salary">Salary</option>
              <option value="hourly">Hourly</option>
              <option value="self-employed">Self-Employed Income</option>
            </select>
          </div>

          <!-- Income Period -->
          <div class="col-md-6">
            <label>Income Period</label>
            <select class="form-control" id="income_period_mfs"
              name="income_period">
              <option value="full_year">Full Year</option>
              <option value="partial_year">Partial Year</option>
            </select>
          </div>

          <!-- Job Incomes -->
          <div class="col-md-12">
            <label>Job Incomes (Multiple Allowed)</label>
            <div id="jobIncomesWrapper"></div>
            <button type="button" class="btn btn-sm btn-primary mt-2"
              onclick="addJobIncome('jobIncomesmarriedsepperatly')">+ Add Job</button>
              <div id="jobIncomesmarriedsepperatly"></div>
          </div>

          <!-- Hidden fixed value -->
          <input type="hidden" id="filing_status_mfs" name="filing_status"
            value="marriedSeparately" />

          <!-- Confirm -->
          <div class="col-md-12">
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" id="checkpointMFS"
                name="checkpointMFS" />
              <label class="form-check-label" for="checkpointMFS">
                Confirm all data entered is accurate
              </label>
            </div>
          </div>

        </div>

        <!-- End Fields for MarriedFilingSepratelyFields -->



        <div class="col-12 mt-3">
          <button type="button" id="calculateBtn" class="btn btn-success w-100">
            Calculate
          </button>
        </div>

      </div>

      <!-- Result -->
      <div id="result" class="result hidden mt-5">
        <h3 class="text-center mb-4">2026 Tax Analysis</h3>

        <div class="row text-center">
          <div class="col-md-4">
            <div class="p-3 border bg-primary">
              <h6>Annual Tax Liability</h6>
              <p id="annual_tax_liability" class="fs-4 fw-bold">$0.00</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 border bg-primary text-white">
              <h6>Current Annual Withholding</h6>
              <p id="current_annual_withholding" class="fs-4 fw-bold">$0.00</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 border bg-danger text-white">
              <h6>Difference</h6>
              <p id="difference" class="fs-4 fw-bold">+$0.00</p>
            </div>
          </div>
        </div>

        <div class="row text-center mt-4">
          <div class="col-md-4">
            <div class="border p-3">
              <h6>Recommended Per Period</h6>
              <p id="recommended_per_period" class="fs-5 fw-bold">$0.00</p>
              <small id="pay_period_label">(Bi-weekly)</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border p-3">
              <h6>Adjustment Needed</h6>
              <p id="adjustment" class="fs-5 fw-bold text-danger">$0.00</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border p-3">
              <h6>Severity</h6>
              <p id="severity_level"
                class="fs-5 fw-bold text-uppercase text-danger">CRITICAL</p>
            </div>
          </div>
        </div>

        <div class="row text-center mt-4">
          <div class="col-md-4">
            <div class="border p-3">
              <h6>Taxable Income</h6>
              <p id="taxable_income" class="fs-5 fw-bold">$0.00</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border p-3">
              <h6>Effective Tax Rate</h6>
              <p id="effective_tax_rate" class="fs-5 fw-bold">0.00%</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border p-3">
              <h6>Marginal Tax Rate</h6>
              <p id="marginal_tax_rate" class="fs-5 fw-bold">0.00%</p>
            </div>
          </div>
        </div>

        <div class="row text-center mt-4">
          <div class="col-md-6">
            <div class="border p-3">
              <h6>Gross Income</h6>
              <p id="gross_income" class="fs-5 fw-bold">$0.00</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="border p-3">
              <h6>Total Deductions</h6>
              <p id="total_deductions" class="fs-5 fw-bold">$0.00</p>
            </div>
          </div>
        </div>

        <div class="row text-center mt-4">
          <div class="col-md-6">
            <div class="border p-3">
              <h6>Federal Tax Before Credits</h6>
              <p id="federal_tax_before_credits" class="fs-5 fw-bold">$0.00</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="border p-3">
              <h6>Child Tax Credit Applied</h6>
              <p id="child_tax_credit_applied" class="fs-5 fw-bold">$0.00</p>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col-md-12">
            <div class="alert alert-danger fw-bold text-center"
              id="recommendation"></div>
          </div>
        </div>
      </div>

    </div>
    <!-- <script src="script.js"></script> -->


    <!-- Bootstrap JS (Popper included) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      let jobIndex = 0;

      function addJobIncome(wrapperId) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;

        const jobId = `job_${jobIndex++}`;
        wrapper.insertAdjacentHTML("beforeend", `
          <div class="job-income border rounded p-2 mb-2" id="${jobId}">
            <div class="row g-2">
              <div class="col-md-4">
                <input type="text" class="form-control" placeholder="Employer Name" data-field="employer_name">
              </div>
              <div class="col-md-4">
                <input type="number" class="form-control" placeholder="Income" data-field="income">
              </div>
              <div class="col-md-3">
                <input type="number" class="form-control" placeholder="Pay Periods" data-field="pay_periods">
              </div>
              <div class="col-md-1">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeJob('${jobId}')">X</button>
              </div>
            </div>
          </div>
        `);
      }

      function removeJob(jobId) {
        document.getElementById(jobId)?.remove();
      }



     // Initialize Bootstrap modal
      const filingStatusModal = new bootstrap.Modal(document.getElementById('filingStatusModal'));

      // Map filing options to form sections
      const formSections = {
        'Single Filer': 'singleFields',
        'Married Filing Jointly': 'marriedFields',
        'Married Filing Separately': 'MarriedFilingSeparatelyFields',
        'Head of House Hold': 'HeadofhouseholdFields',
        'Qualifying Widow(er)': 'QualifyingWidowerFields'
      };

      // Hide all form sections
      function hideAllSections() {
        Object.values(formSections).forEach(id => {
          const section = document.getElementById(id);
          if (section) section.classList.add('hidden');
        });
      }

      // Show selected form section
      function showSection(statusText) {
         console.log("Selected status:", statusText);
        hideAllSections();
        const sectionId = formSections[statusText];
         console.log("Mapped sectionId:", sectionId);
        if (sectionId) {
          const section = document.getElementById(sectionId);
          console.log("Section element:", section);
          if (section) section.classList.remove('hidden');
        }
        // Show the whole form container
        const formContainer = document.getElementById('custom-form');
        if (formContainer) formContainer.classList.remove('hidden');
      }

      // When "Create Scenario" card is clicked, open modal
      document.getElementById('createCard').addEventListener('click', () => {
        filingStatusModal.show();
      });

      // Handle filing status button clicks inside modal
      document.querySelectorAll('#filingStatusModal button').forEach(btn => {
        btn.addEventListener('click', () => {
          const status = btn.textContent.trim();
          showSection(status);
          filingStatusModal.hide();
        });
      });


    
    </script>


    <script>
      function getActiveFilingStatus() {
        if (!document.getElementById('custom-form')) return 'single';

        if (!document.getElementById('singleFields').classList.contains('hidden'))
            return document.getElementById('filing_status').value;
        if (!document.getElementById('marriedFields').classList.contains('hidden'))
            return document.getElementById('filing_status_married').value;
        if (!document.getElementById('HeadofhouseholdFields').classList.contains('hidden'))
            return document.getElementById('filing_status_hoh').value;
        if (!document.getElementById('QualifyingWidowerFields').classList.contains('hidden'))
            return 'qualifyingWidower';
        if (!document.getElementById('MarriedFilingSeparatelyFields').classList.contains('hidden'))
            return document.getElementById('filing_status_mfs').value;

        return 'single';
      }



     // Collect data and build payload
      function getPayload() {
          let filingStatus = getActiveFilingStatus();

          let payload = {
              filing_status: filingStatus,
              annual_income: 0,
              pay_periods: 26,
              current_withholding: 0,
              additional_withholding: 0,
              dependents: 0,
              other_income: 0,
              deductions: 0,
              filing_jointly_both_work: false,
              spouse_income: 0,
              income_type: 'salary',
              income_period: 'full_year',
              job_incomes: []
          };

          // Map inputs based on filing status
          switch (filingStatus) {
              case 'single':
                  payload.annual_income = Number(document.getElementById('annual_income').value) || 0;
                  payload.pay_periods = Number(document.getElementById('pay_periods').value) || 26;
                  payload.current_withholding = Number(document.getElementById('current_withholding').value) || 0;
                  payload.additional_withholding = Number(document.getElementById('additional_withholding').value) || 0;
                  payload.dependents = Number(document.getElementById('dependents').value) || 0;
                  payload.other_income = Number(document.getElementById('other_income').value) || 0;
                  payload.deductions = Number(document.getElementById('deductions').value) || 0;
                  payload.income_type = document.getElementById('income_type').value;
                  payload.income_period = document.getElementById('income_period').value;
                  payload.job_incomes = getJobIncomes('jobIncomesWrapperSingle');
                  break;

              case 'marriedJointly':
                  payload.annual_income = Number(document.getElementById('annual_income_married').value) || 0;
                  payload.spouse_income = Number(document.getElementById('spouse_income').value) || 0;
                  payload.pay_periods = Number(document.getElementById('pay_periods_married').value) || 26;
                  payload.current_withholding = Number(document.getElementById('current_withholding_married').value) || 0;
                  payload.additional_withholding = Number(document.getElementById('additional_withholding_married').value) || 0;
                  payload.dependents = Number(document.getElementById('dependents_married').value) || 0;
                  payload.other_income = Number(document.getElementById('other_income_married').value) || 0;
                  payload.deductions = Number(document.getElementById('deductions_married').value) || 0;
                  payload.filing_jointly_both_work = document.getElementById('filing_jointly_both_work').checked;
                  payload.income_type = document.getElementById('income_type_married').value;
                  payload.income_period = document.getElementById('income_period_married').value;
                  payload.job_incomes = getJobIncomes('jobIncomesWrapperMarried');
                  break;

              case 'headOfHousehold':
                  payload.filing_status = 'headOfHousehold';
                  payload.annual_income = Number(document.getElementById('annual_income_hoh').value) || 0;
                  payload.pay_periods = Number(document.getElementById('pay_periods_hoh').value) || 26;
                  payload.current_withholding = Number(document.getElementById('current_withholding_hoh').value) || 0;
                  payload.additional_withholding = Number(document.getElementById('additional_withholding_hoh').value) || 0;
                  payload.dependents = Number(document.getElementById('dependents_hoh').value) || 0;
                  payload.other_income = Number(document.getElementById('other_income_hoh').value) || 0;
                  payload.deductions = Number(document.getElementById('deductions_hoh').value) || 0;
                  payload.filing_jointly_both_work = document.getElementById('filing_jointly_both_work_hoh')?.checked || false;
                  payload.spouse_income = Number(document.getElementById('spouse_income_hoh').value) || 0;
                  payload.income_type = document.getElementById('income_type_hoh').value || 'salary';
                  payload.income_period = document.getElementById('income_period_hoh').value || 'full_year';
                  payload.job_incomes = getJobIncomes('jobIncomesheadofhousehold'); // returns only income amounts
                  break;

              case 'qualifyingWidower':
                  payload.annual_income = Number(document.getElementById('annual_income_qw').value) || 0;
                  payload.pay_periods = Number(document.getElementById('pay_periods_qw').value) || 26;
                  payload.current_withholding = Number(document.getElementById('current_withholding_qw').value) || 0;
                  payload.additional_withholding = Number(document.getElementById('additional_withholding_qw').value) || 0;
                  payload.dependents = Number(document.getElementById('dependents_qw').value) || 0;
                  payload.other_income = Number(document.getElementById('other_income_qw').value) || 0;
                  payload.deductions = Number(document.getElementById('deductions_qw').value) || 0;
                  payload.filing_jointly_both_work = document.getElementById('filing_jointly_both_work_qw').checked;
                  payload.spouse_income = Number(document.getElementById('spouse_income_qw').value) || 0;
                  payload.income_type = document.getElementById('income_type_qw').value;
                  payload.income_period = document.getElementById('income_period_qw').value;
                  payload.job_incomes = getJobIncomes('jobIncomesqualifyingwidower');
                  break;

              case 'marriedSeparately':
                  payload.annual_income = Number(document.getElementById('annual_income_mfs').value) || 0;
                  payload.pay_periods = Number(document.getElementById('pay_periods_mfs').value) || 26;
                  payload.current_withholding = Number(document.getElementById('current_withholding_mfs').value) || 0;
                  payload.additional_withholding = Number(document.getElementById('additional_withholding_mfs').value) || 0;
                  payload.dependents = Number(document.getElementById('dependents_mfs').value) || 0;
                  payload.other_income = Number(document.getElementById('other_income_mfs').value) || 0;
                  payload.deductions = Number(document.getElementById('deductions_mfs').value) || 0;
                  payload.filing_jointly_both_work = document.getElementById('filing_jointly_both_work_mfs').checked;
                  payload.spouse_income = Number(document.getElementById('spouse_income_mfs').value) || 0;
                  payload.income_type = document.getElementById('income_type_mfs').value;
                  payload.income_period = document.getElementById('income_period_mfs').value;
                  payload.job_incomes = getJobIncomes('jobIncomesmarriedsepperatly');
                  break;
          }

          return payload;
      }

    // Helper function to collect job incomes
    function getJobIncomes(wrapperId) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return [];

        const jobs = [];
        wrapper.querySelectorAll('.job-income').forEach(jobDiv => {
            const incomeField = jobDiv.querySelector('input[data-field="income"]');
            if (incomeField) {
                const amount = Number(incomeField.value) || 0;
                jobs.push(amount); // only push the income amount
            }
        });

        return jobs;
    }


    // Send payload to API
    async function calculateTax() {
      const payload = getPayload();
      const endpoint = ['headOfHousehold', 'qualifyingWidower'].includes(payload.filing_status)
                      ? '/tax/calculate/detailed'
                      : '/tax/calculate';
      console.log("Payload sent:", payload);

      try {
          const response = await fetch(`https://api2.on10.io${endpoint}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
              body: JSON.stringify(payload)
          });
          const data = await response.json();
          console.log('Tax Calculation Result:', data);

          // Show result div
          const resultDiv = document.getElementById('result');
          resultDiv.classList.remove('hidden');

          // Populate fields
          document.getElementById('annual_tax_liability').textContent = `$${data.annual_tax_liability.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('current_annual_withholding').textContent = `$${data.current_annual_withholding.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('difference').textContent = `${data.difference >= 0 ? '+' : '-'}$${Math.abs(data.difference).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('recommended_per_period').textContent = `$${data.recommended_per_period.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('pay_period_label').textContent = `(${data.pay_period_label})`;
          document.getElementById('adjustment').textContent = `$${data.adjustment.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('severity_level').textContent = data.severity_level.toUpperCase();
          document.getElementById('taxable_income').textContent = `$${data.taxable_income.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('effective_tax_rate').textContent = `${data.effective_tax_rate.toFixed(2)}%`;
          document.getElementById('marginal_tax_rate').textContent = `${data.marginal_tax_rate.toFixed(2)}%`;
          document.getElementById('gross_income').textContent = `$${data.gross_income.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('total_deductions').textContent = `$${data.total_deductions.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('federal_tax_before_credits').textContent = `$${data.federal_tax_before_credits.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('child_tax_credit_applied').textContent = `$${data.child_tax_credit_applied.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
          document.getElementById('recommendation').textContent = data.recommendation;

      } catch (err) {
          console.error(err);
          alert('Failed to calculate tax. See console for details.');
      }
  }

    // Bind button
    document.getElementById('calculateBtn').addEventListener('click', calculateTax);




    // Define scenario data
    const scenarios = {
        jamesCard: { filing_status: 'single', annual_income: 30000, dependents: 0 },
        jasonCard: { filing_status: 'headOfHousehold', annual_income: 52000, dependents: 2 },
        amberCard: { filing_status: 'single', annual_income: 75000, dependents: 0 },
        nickKavyaCard: { filing_status: 'marriedJointly', annual_income: 85000, dependents: 2 }
    };

    // Calculate tax for a scenario and show in main #result section
    async function calculateTaxWithScenario(scenarioData) {
        let payload = {
            filing_status: scenarioData.filing_status,
            annual_income: scenarioData.annual_income || 0,
            pay_periods: 26,
            current_withholding: 0,
            additional_withholding: 0,
            dependents: scenarioData.dependents || 0,
            other_income: 0,
            deductions: 0,
            filing_jointly_both_work: false,
            spouse_income: scenarioData.spouse_income || 0,
            income_type: 'salary',
            income_period: 'full_year',
            job_incomes: scenarioData.job_incomes || []
        };

        const endpoint = ['headOfHousehold', 'qualifyingWidower'].includes(payload.filing_status)
                          ? '/tax/calculate/detailed'
                          : '/tax/calculate';

        try {
            const response = await fetch(`https://api2.on10.io${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            console.log('Tax Calculation Result:', data);

            // Show the main result section
            const resultSection = document.getElementById('result');
            resultSection.classList.remove('hidden');

            // Populate fields
            document.getElementById('annual_tax_liability').textContent = `$${data.annual_tax_liability.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('current_annual_withholding').textContent = `$${data.current_annual_withholding.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('difference').textContent = `${data.difference >= 0 ? '+' : '-'}$${Math.abs(data.difference).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('recommended_per_period').textContent = `$${data.recommended_per_period.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('pay_period_label').textContent = `(${data.pay_period_label})`;
            document.getElementById('adjustment').textContent = `$${data.adjustment.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('severity_level').textContent = data.severity_level.toUpperCase();
            document.getElementById('taxable_income').textContent = `$${data.taxable_income.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('effective_tax_rate').textContent = `${data.effective_tax_rate.toFixed(2)}%`;
            document.getElementById('marginal_tax_rate').textContent = `${data.marginal_tax_rate.toFixed(2)}%`;
            document.getElementById('gross_income').textContent = `$${data.gross_income.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('total_deductions').textContent = `$${data.total_deductions.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('federal_tax_before_credits').textContent = `$${data.federal_tax_before_credits.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('child_tax_credit_applied').textContent = `$${data.child_tax_credit_applied.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
            document.getElementById('recommendation').textContent = data.recommendation;

        } catch (err) {
            console.error(err);
            alert('Failed to calculate tax. See console for details.');
        }
    }

    // Add click listeners to cards
    document.querySelectorAll('.profiles .card').forEach(card => {
        card.addEventListener('click', () => {
            if (card.id === 'createCard') return;

            const scenarioData = scenarios[card.id];
            if (!scenarioData) return;

            calculateTaxWithScenario(scenarioData);
        });
    });
    </script>
  </body>
</html>
